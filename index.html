<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=1080, height=1920, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Fotos do Casamento üíç</title>

<style>
* { touch-action: pan-y; }
html, body {
  margin: 0; padding: 0;
  width: 1080px; height: 1920px;
  overflow: hidden;
  font-family: Arial, sans-serif;
}

.topo {
  width: 1080px;
  height: 960px;
  background: url('topo.jpg') center / cover no-repeat;
}

.base {
  width: 1080px;
  height: 960px;
  background: url('fundo2.jpg') center / cover no-repeat;
  padding: 30px;
  box-sizing: border-box;
}

.tabs {
  display: flex;
  justify-content: center;
  gap: 30px;
  margin-bottom: 25px;
}

.tab-btn {
  padding: 18px 45px;
  border-radius: 40px;
  border: 2px solid #5f84b8;
  background: #fff;
  color: #5f84b8;
  font-size: 20px;
  font-weight: bold;
  cursor: pointer;
}

.gallery-area {
  height: 720px;
  overflow-y: auto;
}

.gallery {
  display: grid;
  grid-template-columns: repeat(5, 180px);
  gap: 16px;
  justify-content: center;
}

.gallery img {
  width: 180px;
  height: 180px;
  object-fit: cover;
  border-radius: 16px;
  cursor: pointer;
}

.upload-area {
  display: none;
  text-align: center;
}

.btn {
  padding: 20px 55px;
  border-radius: 45px;
  border: 2px solid #5f84b8;
  background: #fff;
  color: #5f84b8;
  font-size: 20px;
  font-weight: bold;
  cursor: pointer;
}

input[type=file] { display: none; }

.status {
  margin-top: 18px;
  color: #5f84b8;
  font-size: 18px;
}

/* LIGHTBOX */
.lightbox {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.9);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 999;
}

.lightbox img {
  max-width: 95%;
  max-height: 95%;
  border-radius: 20px;
}
</style>
</head>

<body>

<div class="topo"></div>

<div class="base">

  <div class="tabs">
    <button class="tab-btn" onclick="abrirGaleria()">Galeria</button>
    <button class="tab-btn" onclick="abrirUpload()">Enviar fotos</button>
  </div>

  <!-- GALERIA -->
  <div class="gallery-area" id="galeria">
    <div class="gallery" id="gallery"></div>
  </div>

  <!-- UPLOAD -->
  <div class="upload-area" id="upload">
    <label class="btn">
      üì∏ Escolher at√© 10 fotos
      <input type="file" id="files" multiple accept="image/*">
    </label>
    <div class="status" id="status"></div>
  </div>

</div>

<!-- LIGHTBOX -->
<div class="lightbox" id="lightbox" onclick="fecharLightbox()">
  <img id="lightboxImg">
</div>

<script>
/* ====== CONFIGURA√á√ïES ====== */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyzuoFR0uh9fS1pg0jF1ullAp2_UqeNx2ju62QmgCbSJ5EqH-Im47lCCwSij9bqnO";
const API_KEY = "AIzaSyC8QVF3RinI2D3JnLarPucU7uFMNLjIwl8";
const FOLDER_ID = "1Eu6-lW8Pq6eKjLNvwXz_xiOhCpQ0vCFA";

/* ====== ELEMENTOS ====== */
const filesInput = document.getElementById('files');
const status = document.getElementById('status');
const gallery = document.getElementById('gallery');
const galeria = document.getElementById('galeria');
const upload = document.getElementById('upload');
const lightbox = document.getElementById('lightbox');
const lightboxImg = document.getElementById('lightboxImg');

/* ====== ABAS ====== */
function abrirGaleria(){
  galeria.style.display = 'block';
  upload.style.display = 'none';
}
function abrirUpload(){
  galeria.style.display = 'none';
  upload.style.display = 'block';
}

/* ====== ENVIO DE FOTOS ====== */
filesInput.addEventListener('change', async () => {
  const files = [...filesInput.files];
  if (!files.length) return;
  if (files.length > 10) {
    alert('Voc√™ pode enviar no m√°ximo 10 fotos por vez');
    filesInput.value = '';
    return;
  }

  status.innerText = 'üì§ Enviando fotos...';

  for (const file of files) {
    await enviarArquivo(file);
  }

  status.innerText = '‚úÖ Fotos enviadas com sucesso';
  filesInput.value = '';
  carregarGaleria();
});

function enviarArquivo(file){
  return new Promise(resolve => {
    const reader = new FileReader();
    reader.onload = () => {
      const formData = new FormData();
      formData.append('file', reader.result.split(',')[1]);
      formData.append('filename', file.name);
      formData.append('mimeType', file.type);

      fetch(SCRIPT_URL, { method: 'POST', body: formData })
        .then(() => resolve())
        .catch(() => resolve());
    };
    reader.readAsDataURL(file);
  });
}

/* ====== GALERIA ====== */
function carregarGaleria(){
  fetch(`https://www.googleapis.com/drive/v3/files?q='${FOLDER_ID}'+in+parents+and+mimeType contains 'image/'&orderBy=createdTime desc&fields=files(id,name)&pageSize=100&key=${API_KEY}`)
    .then(r => r.json())
    .then(d => {
      gallery.innerHTML = '';
      if (!d.files || !d.files.length) {
        gallery.innerHTML = '<p>Nenhuma foto encontrada.</p>';
        return;
      }

      d.files.forEach(f => {
        const img = document.createElement('img');
        // LINK DIRETO FUNCIONAL
        img.src = `https://drive.google.com/uc?export=view&id=${f.id}`;
        img.alt = f.name;
        img.onclick = () => abrirLightbox(img.src);
        gallery.appendChild(img);
      });
    })
    .catch(err => {
      console.error('Erro ao carregar galeria:', err);
      gallery.innerHTML = '<p>Erro ao carregar fotos.</p>';
    });
}

/* ====== LIGHTBOX ====== */
function abrirLightbox(src){
  lightboxImg.src = src;
  lightbox.style.display = 'flex';
}
function fecharLightbox(){
  lightbox.style.display = 'none';
}

/* ====== ATUALIZA√á√ÉO AUTOM√ÅTICA ====== */
setInterval(carregarGaleria, 30000);

/* ====== CARREGAR GALERIA INICIAL ====== */
carregarGaleria();
abrirGaleria(); // abre aba de galeria por padr√£o
</script>

</body>
</html>
